# Cranberry Synth 操作マニュアル

## 6オペレーター FM シンセサイザー

---

# 目次

1. はじめに
2. ボタン操作の基本
3. LED インジケーター
4. 画面遷移マップ
5. タイトル画面
6. プリセット画面（メインハブ）
7. オペレーター設定
8. マスター設定
9. LFO 設定
10. エフェクト設定
11. メニュー画面
12. オシロスコープ
13. エンベロープモニター
14. パススルーモード
15. MIDI プレイヤー
16. MIDI 接続
17. FM 合成の基礎知識
18. パラメータ一覧表

---

# 1. はじめに

**Cranberry Synth** は Teensy 4.1 上で動作する 6 オペレーター FM シンセサイザーです。

| 項目 | 仕様 |
|:---|:---|
| オペレーター数 | 6 |
| アルゴリズム数 | 32 |
| 同時発音数 | 16 音 |
| サンプルレート | 44,100 Hz |
| 内部演算 | 24 bit (Q23) |
| 出力 | 16 bit |
| エフェクト | Delay, LPF, HPF, Chorus, Reverb |
| ディスプレイ | 128×128 RGB OLED |
| MIDI 入力 | USB MIDI / ハードウェア MIDI IN |

**FM 合成**とは、あるオシレーター（モジュレーター）の出力で別のオシレーター（キャリア）の周波数を変調する合成方式です。シンプルなサイン波の組み合わせから、金属的なベル音、ブラス、ストリングスなど多彩な音色を作ることができます。

---

# 2. ボタン操作の基本

本シンセサイザーには、**ロータリーエンコーダー 1 個**と**ボタン 6 個**があります。

## ボタンの役割

| ボタン | 主な役割 | 長押し時 |
|:---:|:---|:---|
| **▲ UP** | カーソルを上に移動 | 連続移動 |
| **▼ DOWN** | カーソルを下に移動 | 連続移動 |
| **◀ LEFT** | パラメータ値を下げる（−1） | 大きいステップで下げる（−5〜12） |
| **▶ RIGHT** | パラメータ値を上げる（+1） | 大きいステップで上げる（+5〜12） |
| **ENTER** | 決定 / 画面遷移 / トグル切替 | ― |
| **CANCEL** | 前の画面に戻る | ― |

## ロータリーエンコーダー

| 操作 | 動作 |
|:---|:---|
| **右回転** | RIGHT ボタンと同じ（値を上げる） |
| **左回転** | LEFT ボタンと同じ（値を下げる） |
| **押し込み（クリック）** | ENTER ボタンと同じ |

> **ヒント**: エンコーダーを回すとパラメータ値を素早く変更できます。ボタンの短押しで微調整、長押しで大きく変更するのがおすすめです。

---

# 3. LED インジケーター

本体には 4 つの LED があります。

| LED | 場所 | 動作 |
|:---|:---|:---|
| **Power** | 電源表示 | 起動時に点灯（常時 ON） |
| **MIDI** | MIDI 入力 | MIDI データ受信時に点滅 |
| **Audio** | オーディオ出力 | 音声出力中に点灯 |
| **Status** | 状態表示 | パススルーモード中：常時点灯 / MIDI Player 再生中：点滅 |

---

# 4. 画面遷移マップ

電源を入れるとタイトル画面が表示されます。ENTER を押すとプリセット画面（メインハブ）に移動します。

```
タイトル画面
  └─ [ENTER] → プリセット画面（メインハブ）
                  │
                  ├─ OP1〜OP6 → オペレーター設定
                  │                ├─ ピッチ設定
                  │                ├─ エンベロープ設定
                  │                └─ 感度設定
                  │
                  ├─ M（マスター）→ マスター設定
                  │                    └─ LFO 設定
                  │
                  ├─ FX → エフェクト一覧
                  │         ├─ Delay
                  │         ├─ Chorus
                  │         ├─ Reverb
                  │         ├─ LPF
                  │         └─ HPF
                  │
                  └─ MENU → メニュー
                              ├─ パススルーモード
                              ├─ MIDI プレイヤー
                              ├─ オシロスコープ
                              └─ エンベロープモニター
```

**どの画面からでも CANCEL ボタンで前の画面に戻れます。**

---

# 5. タイトル画面

電源を入れると最初に表示される画面です。

- 画面に「**Cranberry**」と「**FM SYNTHESIZER**」が表示されます
- 背景にはサイン波のアニメーションが流れています
- **ENTER を押す**とプリセット画面に移動します

---

# 6. プリセット画面（メインハブ）

シンセサイザーの中心となる画面です。ここからすべての設定にアクセスできます。

## 画面構成

```
┌────────────────────────┐
│ 001:INIT_SINE          │  ← プリセット名
│ Algorithm: 1           │  ← アルゴリズム番号
│ ┌──┐ ┌──┐ ┌──┐        │
│ │ 1│ │ 2│ │ 3│        │  ← オペレーターボックス
│ └──┘ └──┘ └──┘        │
│ ┌──┐ ┌──┐ ┌──┐        │    色が付いている＝有効
│ │ 4│ │ 5│ │ 6│  [M]   │  ← [M]=マスター設定
│ └──┘ └──┘ └──┘        │
│ FX     POLY:0    MENU  │  ← フッター
│                DSP:12% │  ← CPU 使用率
└────────────────────────┘
```

## 操作方法

| 選択項目 | 操作 | 動作 |
|:---|:---|:---|
| **PRESET** | ◀▶ | プリセットを切り替え（ループ） |
| **PRESET** | ENTER | ランダムプリセットを生成 |
| **ALGO** | ◀▶ | アルゴリズムを変更（1〜32） |
| **OP1〜OP6** | ENTER | そのオペレーターの設定画面へ |
| **M** | ENTER | マスター設定画面へ |
| **FX** | ENTER | エフェクト設定画面へ |
| **POLY** | ENTER | 緊急リセット（音が止まらない時に） |
| **MENU** | ENTER | メニュー画面へ |

### アルゴリズム図について

画面中央にはオペレーター同士の接続関係が図で表示されます。

- **線でつながったボックス** → 上のオペレーターが下のオペレーターの音を変調しています
- **下部のバスライン（横線）に繋がるオペレーター** → 最終出力（キャリア）
- **矢印付きの丸** → フィードバック（自分自身を変調）

> **ヒント**: まずはプリセットを切り替えて色々な音を聴いてみましょう。気に入った音が見つかったら、オペレーターやエフェクトを少しずつ調整してオリジナルの音色を作ってみてください。

---

# 7. オペレーター設定

プリセット画面で OP1〜OP6 を選んで ENTER を押すと開きます。

## メイン画面

| 項目 | 操作 | 説明 |
|:---|:---|:---|
| **ENABLED** | ENTER | オペレーターの ON/OFF を切替 |
| **WAVE** | ◀▶ | 波形を選択：SINE（正弦波）、TRI（三角波）、SAW（のこぎり波）、SQR（矩形波） |
| **LEVEL** | ◀▶ | 出力レベル（0〜99）。音量の大きさを決めます |
| **PITCH** | ENTER | ピッチ設定のサブ画面へ |
| **ENV** | ENTER | エンベロープ設定のサブ画面へ |
| **SENS** | ENTER | 感度設定のサブ画面へ |

## ピッチ設定（PITCH）

オペレーターの周波数を決める設定です。

| 項目 | 範囲 | 説明 |
|:---|:---:|:---|
| **MODE** | RATIO / FIXED | RATIO＝基音の倍率で指定、FIXED＝固定周波数 |
| **COARSE** | 0〜31 | 大まかな周波数比（0 = 0.5倍、1 = 1倍、2 = 2倍…） |
| **FINE** | 0〜99 | 微調整（COARSE × (1 + FINE/100)） |
| **DETUNE** | −7〜+7 | デチューン（わずかな音程のずれ。音に厚みが出ます） |

> **例**: COARSE=2, FINE=0 なら基音の 2 倍の周波数（1 オクターブ上）になります。

## エンベロープ設定（ENV）

音の時間変化を 4 つのフェーズ（段階）で設定します。

```
音量
 ▲     L1
 │    ╱╲
 │   ╱  ╲  L2
 │  ╱    ╲───╲  L3
 │ ╱           ╲────────
 │╱                     ╲  L4
 └──────────────────────────→ 時間
   R1   R2    R3         R4
  攻撃  減衰1  減衰2     解放
```

| 項目 | 範囲 | 説明 |
|:---|:---:|:---|
| **R1** | 0〜99 | アタックの速さ（大きいほど速い） |
| **R2** | 0〜99 | ディケイ 1 の速さ |
| **R3** | 0〜99 | ディケイ 2（サステイン移行）の速さ |
| **R4** | 0〜99 | リリースの速さ（鍵盤を離した後） |
| **L1** | 0〜99 | アタック到達レベル（通常 99） |
| **L2** | 0〜99 | ディケイ 1 到達レベル |
| **L3** | 0〜99 | サステインレベル（鍵盤を押し続けた時の音量） |
| **L4** | 0〜99 | リリース到達レベル（通常 0） |

画面下部にはエンベロープの形が**リアルタイムでグラフ表示**されます。

## 感度設定（SENS）

音の応答特性を細かく調整する上級者向けの設定です。

| 項目 | 範囲 | 説明 |
|:---|:---:|:---|
| **AMS** | 0〜3 | LFO 振幅変調の感度（0=OFF） |
| **VEL SENS** | 0〜7 | ベロシティ感度（0=一定音量、7=強弱が最大限反映） |
| **RATE SCL** | 0〜7 | レートスケーリング（高い音ほどエンベロープが速くなる） |
| **BP** | 0〜99 | ブレークポイント（スケーリングの基準ノート） |
| **L DEPTH** | 0〜99 | ブレークポイントより低い音のスケーリング深度 |
| **R DEPTH** | 0〜99 | ブレークポイントより高い音のスケーリング深度 |
| **L CURVE** | 4 種 | 低音側カーブ：-LN, -EX, +EX, +LN |
| **R CURVE** | 4 種 | 高音側カーブ：-LN, -EX, +EX, +LN |

---

# 8. マスター設定

プリセット画面で **M** を選んで ENTER を押すと開きます。シンセサイザー全体に関わる設定です。

| 項目 | 範囲 | 操作 | 説明 |
|:---|:---:|:---|:---|
| **LEVEL** | 0〜100% | ◀▶ (±1% / ±10%) | マスターボリューム |
| **TRANSPOSE** | −24〜+24 | ◀▶ | トランスポーズ（半音単位で音程を上下） |
| **FEEDBACK** | 0〜7 | ◀▶ | フィードバック量（オペレーターの自己変調。大きいほど倍音が増えます） |
| **VEL CURVE** | 4 種 | ◀▶ | ベロシティカーブ：LINEAR（リニア）、EXP（指数）、LOG（対数）、FIXED（固定） |
| **LFO** | ― | ENTER | LFO 設定画面へ |

---

# 9. LFO 設定

マスター設定画面で **LFO** を選んで ENTER を押すと開きます。

LFO（Low Frequency Oscillator）は、ビブラートやトレモロなどの**ゆっくりとした音の揺れ**を作るための機能です。

| 項目 | 範囲 | 説明 |
|:---|:---:|:---|
| **WAVE** | 6 種 | 波形：TRI（三角波）、SAW↓ / SAW↑（のこぎり波）、SQR（矩形波）、SIN（正弦波）、S&H（サンプル&ホールド） |
| **SPEED** | 0〜99 | 揺れの速さ（約 0.06〜50 Hz） |
| **DELAY** | 0〜99 | ノートオン後、LFO が効き始めるまでの遅延（0〜5秒） |
| **PM DEPTH** | 0〜99 | ピッチモジュレーションの深さ（ビブラートの強さ） |
| **AM DEPTH** | 0〜99 | アンプリチュードモジュレーションの深さ（トレモロの強さ） |
| **P.M.SENS** | 0〜7 | ピッチモジュレーション感度 |
| **KEY SYNC** | ON/OFF | ON にすると鍵盤を押すたびに LFO がリセットされます |
| **OSC SYNC** | ON/OFF | ON にすると鍵盤を押すたびにオシレーターの位相がリセットされます |

> **初心者向け**: ビブラートをかけるには PM DEPTH を上げてください（20〜40 くらいから試す）。SPEED は 30 前後が自然です。

---

# 10. エフェクト設定

プリセット画面で **FX** を選んで ENTER を押すとエフェクト一覧が表示されます。有効なエフェクトにはシアン色の丸印がつきます。

## Delay（ディレイ / エコー）

| 項目 | 範囲 | 説明 |
|:---|:---:|:---|
| **ENABLED** | ON/OFF | ディレイの有効/無効 |
| **TIME** | 1〜300 ms | エコーの間隔（5ms 刻み） |
| **LEVEL** | 0〜99% | エコー音の音量 |
| **FEEDBACK** | 0〜99% | エコーの繰り返し量（高いほど長く残る） |

## LPF（ローパスフィルター）

| 項目 | 範囲 | 説明 |
|:---|:---:|:---|
| **ENABLED** | ON/OFF | フィルターの有効/無効 |
| **CUTOFF** | 20Hz〜20kHz | カットオフ周波数（これより上の音を削る） |
| **Q** | 0.1〜10.0 | レゾナンス（カットオフ付近を強調） |
| **MIX** | 0〜100% | 効果の適用量 |

> **操作のコツ**: CUTOFF は対数スケールで変わります（低い周波数帯では細かく、高い周波数帯では大きく変化）。

## HPF（ハイパスフィルター）

LPF と同じ構成ですが、カットオフ周波数**より下**の音を削ります。

## Chorus（コーラス）

| 項目 | 範囲 | 説明 |
|:---|:---:|:---|
| **ENABLED** | ON/OFF | コーラスの有効/無効 |
| **RATE** | ― | 揺れの速さ |
| **DEPTH** | ― | 揺れの深さ |
| **MIX** | 0〜100% | 効果の適用量 |

## Reverb（リバーブ）

| 項目 | 範囲 | 説明 |
|:---|:---:|:---|
| **ENABLED** | ON/OFF | リバーブの有効/無効 |
| **ROOM** | 0〜99 | 部屋の広さ（大きいほど残響が長い） |
| **DAMP** | 0〜99 | ダンピング（高域の減衰。大きいほど柔らかい残響に） |
| **MIX** | 0〜100% | 効果の適用量 |

---

# 11. メニュー画面

プリセット画面で **MENU** を選んで ENTER を押すと開きます。

| 項目 | 説明 |
|:---|:---|
| **PASSTHROUGH** | パススルーモード（外部入力をそのまま出力） |
| **MIDI PLAYER** | SD カードの MIDI ファイルを再生 |
| **OSCILLOSCOPE** | リアルタイム波形表示 |
| **ENV MONITOR** | エンベロープの動作をリアルタイム監視 |

---

# 12. オシロスコープ

出力波形をリアルタイムで表示する画面です。音作りの確認に便利です。

| 操作 | 機能 |
|:---|:---|
| **▲ / ▼** | 表示チャンネル切替：L+R → L のみ → R のみ |
| **◀ / ▶** | 表示倍率の変更：x1, x2, x4, x6, x8, x12, x16 |
| **ENTER** | フリーズ（波形の一時停止）/ 解除 |
| **CANCEL** | 前画面に戻る |

画面下部の操作ガイド：`↑↓:CH ←→:AMP ET:FRZ`

---

# 13. エンベロープモニター

6 つのオペレーターのエンベロープの動作を同時にリアルタイムで監視できます。

- 画面は **2 行 × 3 列**のグリッドに分かれ、各セルに 1 オペレーターが表示されます
- **シアン色** = キャリア（音の出力に直結するオペレーター）
- **イエロー色** = モジュレーター（他のオペレーターを変調する役割）
- 各オペレーターの現在のフェーズ（A=アタック、D1、D2、R=リリース、−=アイドル）が表示されます
- 白いクロスマーカーが現在のエンベロープ位置を示します

鍵盤を弾きながらこの画面を見ると、各オペレーターがどのように動作しているかを視覚的に理解できます。

---

# 14. パススルーモード

メニューから **PASSTHROUGH** を選ぶと、PCM1802 ADC からの**外部オーディオ入力**をそのまま DAC に出力するモードに入ります。

- FM シンセサイザーは一時停止し、MIDI 入力も停止します
- **Status LED** が常時点灯します
- ボリューム調整とエフェクト（LPF, HPF, Delay, Chorus, Reverb）を適用できます
- **CANCEL** を押すとシンセモードに復帰します

ギターやマイクなどの外部音源にエフェクトをかけるのに使えます。

---

# 15. MIDI プレイヤー

メニューから **MIDI PLAYER** を選ぶと、SD カードに保存した MIDI ファイル（.mid）を再生できます。

## 操作方法

1. microSD カードのルートディレクトリに **.mid ファイル**を入れておきます
2. MIDI PLAYER 画面を開くとファイル一覧が表示されます
3. **▲ / ▼** でファイルを選択
4. **ENTER** で再生開始
5. **STOP** を選んで **ENTER** で再生停止

再生中は Status LED が点滅します。

---

# 16. MIDI 接続

Cranberry Synth は以下の 2 つの方法で MIDI 入力を受け取ります。

## USB MIDI

USB ケーブルで PC や iPad に接続すると、DAW やソフトウェアから直接演奏できます。

## ハードウェア MIDI IN

5 ピン DIN コネクタ（または 3.5mm TRS）を使って、キーボードや MIDI コントローラーを接続できます。Serial7 ポートを使用しています。

## 対応メッセージ

| メッセージ | 説明 |
|:---|:---|
| **ノートオン** | 鍵盤を押す（音を鳴らす） |
| **ノートオフ** | 鍵盤を離す（音を止める） |
| **ピッチベンド** | 音程を滑らかに変化 |

- 全 16 チャンネルを受信します（OMNI モード）
- USB MIDI とハードウェア MIDI は同時に使用できます

---

# 17. FM 合成の基礎知識

## オペレーターとは？

FM シンセサイザーの基本単位です。1 つのオペレーターは **オシレーター（音を作る部分）** と **エンベロープ（音量の時間変化を決める部分）** で構成されています。

## キャリアとモジュレーター

- **キャリア**: 最終的に耳に聞こえる音を出すオペレーター
- **モジュレーター**: キャリアの周波数を変調して音色を変えるオペレーター

## アルゴリズム

6 つのオペレーターの接続方法のパターンを「アルゴリズム」と呼びます。全 32 種類あり、それぞれ異なる音色の特性があります。

| タイプ | 特徴 | 例 |
|:---|:---|:---|
| 直列接続が多い | 複雑な倍音構造 / 金属的な音 | ベル、チャイム |
| 並列接続が多い | 倍音加算的 / オルガンのような音 | オルガン、パッド |
| 混合型 | バランスの取れた音色 | ブラス、ストリングス |

## フィードバック

1 つのオペレーターが自分自身の出力で自分を変調する機能です。フィードバック量を上げるとノコギリ波に近い波形になり、倍音が豊かになります。

## 簡単な音作りのステップ

1. **プリセットを選ぶ**: まずは内蔵プリセットを試して好みの方向性を見つけます
2. **アルゴリズムを理解する**: プリセット画面の図を見て「どのオペレーターがキャリアか」を確認します
3. **レベルを調整する**: モジュレーターのレベルを変えると音色が大きく変わります
4. **周波数比を変える**: モジュレーターの COARSE を 1, 2, 3... と変えると倍音構成が変わります
5. **エンベロープで動きをつける**: モジュレーターのエンベロープを変えると、時間とともに音色が変化します
6. **エフェクトを追加**: Reverb や Chorus で空間的な広がりを加えます

---

# 18. パラメータ一覧表

## オペレーター

| パラメータ | 範囲 | 説明 |
|:---|:---:|:---|
| Enabled | ON/OFF | オペレーターの有効/無効 |
| Wave | SINE/TRI/SAW/SQR | 波形選択 |
| Level | 0-99 | 出力レベル |
| Mode | RATIO/FIXED | 周波数モード |
| Coarse | 0-31 | 周波数比（粗調整） |
| Fine | 0-99 | 周波数比（微調整） |
| Detune | −7〜+7 | デチューン |

## エンベロープ

| パラメータ | 範囲 | 説明 |
|:---|:---:|:---|
| Rate 1-4 | 0-99 | 各フェーズの速さ |
| Level 1-4 | 0-99 | 各フェーズの目標レベル |
| Rate Scaling | 0-7 | 高音ほどエンベロープが速くなる |

## キーボードレベルスケーリング

| パラメータ | 範囲 | 説明 |
|:---|:---:|:---|
| Break Point | 0-99 | 基準ノート |
| Left/Right Depth | 0-99 | スケーリングの深さ |
| Left/Right Curve | -LN/-EX/+EX/+LN | カーブの種類 |

## LFO

| パラメータ | 範囲 | 説明 |
|:---|:---:|:---|
| Wave | TRI/SAW↓/SAW↑/SQR/SIN/S&H | 波形 |
| Speed | 0-99 | 速さ |
| Delay | 0-99 | 遅延時間 |
| PM Depth | 0-99 | ピッチ変調の深さ |
| AM Depth | 0-99 | 振幅変調の深さ |
| P.M.Sens | 0-7 | ピッチ変調感度 |
| Key Sync | ON/OFF | ノートオン時リセット |
| OSC Sync | ON/OFF | オシレーター位相リセット |

## マスター

| パラメータ | 範囲 | 説明 |
|:---|:---:|:---|
| Level | 0-100% | マスターボリューム |
| Transpose | −24〜+24 | トランスポーズ |
| Feedback | 0-7 | フィードバック量 |
| Velocity Curve | LINEAR/EXP/LOG/FIXED | ベロシティカーブ |

## エフェクト

| エフェクト | パラメータ | 範囲 |
|:---|:---|:---:|
| Delay | Time / Level / Feedback | 1-300ms / 0-99% / 0-99% |
| LPF | Cutoff / Q / Mix | 20Hz-20kHz / 0.1-10.0 / 0-100% |
| HPF | Cutoff / Q / Mix | 20Hz-20kHz / 0.1-10.0 / 0-100% |
| Chorus | Rate / Depth / Mix | ― / ― / 0-100% |
| Reverb | Room / Damp / Mix | 0-99 / 0-99 / 0-100% |

---

*Cranberry Synth — 6-Operator FM Synthesizer on Teensy 4.1*

*Made by Saisana299*
